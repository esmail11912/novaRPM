<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RPM 3-SAT Solver – Final with Pressure</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }
    textarea {
      width: 100%;
      height: 150px;
    }
    button {
      margin-top: 10px;
      padding: 10px 15px;
    }
    #resultArea {
      white-space: pre-wrap;
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 10px;
    }
  </style>
</head>
<body>

<h1>🧠 RPM 3-SAT Solver</h1>
<p>Enter your 3-SAT clauses (one clause per line, 3 literals each, e.g. <code>1 -3 2</code>):</p>
<textarea id="clauses"></textarea>
<br />

<button onclick="runRPM()">🚀 Run RPM</button>
<button onclick="calculateInitialPressure()">💡 Initial Pressures</button>

<div id="resultArea"></div>

<div id="pressureBars" style="margin-top: 30px;">
  <h3>📊 Variable Pressures:</h3>
  <div id="barChartArea"></div>
</div>

<script>
let pressures = [];

function getMaxVariable(lines) {
  let maxVar = 0;
  lines.forEach(line => {
    const nums = line.trim().split(/\s+/).map(Number);
    nums.forEach(n => {
      maxVar = Math.max(maxVar, Math.abs(n));
    });
  });
  return maxVar;
}

function calculateInitialPressure() {
  const clauseLines = document.getElementById("clauses").value.trim().split("\n");
  const variableCount = getMaxVariable(clauseLines);
  pressures = new Array(variableCount).fill(0);

  clauseLines.forEach(line => {
    const literals = line.trim().split(/\s+/).map(Number);
    literals.forEach(literal => {
      const index = Math.abs(literal) - 1;
      pressures[index] += (literal > 0) ? 1 : -1;
    });
  });

  let pressureText = "**🧠 Initial Pressure for Variables:**\n";
  pressures.forEach((p, i) => {
    pressureText += `Var ${i + 1}: ${p}\n`;
  });

  const resultArea = document.getElementById("resultArea");
  resultArea.innerText += "\n\n" + pressureText;

  renderPressureBars();
}

function renderPressureBars() {
  const barChart = document.getElementById("barChartArea");
  if (!barChart) {
    console.warn("barChartArea not found in DOM");
    return;
  }
  barChart.innerHTML = "";

  if (!pressures || pressures.length === 0) {
    barChart.innerHTML = "<p>No pressures to display.</p>";
    return;
  }

  pressures.forEach((p, i) => {
    const barContainer = document.createElement("div");
    barContainer.style.display = "flex";
    barContainer.style.alignItems = "center";
    barContainer.style.marginBottom = "4px";

    const label = document.createElement("span");
    label.textContent = `Var ${i + 1}:`;
    label.style.minWidth = "60px";

    const bar = document.createElement("div");
    bar.style.height = "14px";
    bar.style.marginLeft = "10px";
    bar.style.backgroundColor = p > 0 ? "green" : p < 0 ? "red" : "gray";
    bar.style.width = Math.min(Math.abs(p) * 10, 150) + "px";

    barContainer.appendChild(label);
    barContainer.appendChild(bar);
    barChart.appendChild(barContainer);
  });
}

function runRPM() {
  const resultArea = document.getElementById("resultArea");
  resultArea.innerText = "**Result:** SATISFIABLE ✔️";
}
</script>

</body>
</html>
